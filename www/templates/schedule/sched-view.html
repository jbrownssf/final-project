<ion-view view-title="Seasonally Scheduling">
    <!-- Include ion-nav-buttons in every index to avoid breaking the app (ionic material bug) -->
    <!--<ion-nav-buttons></ion-nav-buttons>-->
    <ion-nav-buttons side="right">
        <button class="button button-icon icon ion-edit button-clear" ng-click="edit()" ng-if="canEdit">
            
        </button>
    </ion-nav-buttons>
  <ion-nav-buttons side="left">
    <button class="button button-icon icon button-clear ion-ios-home" ng-if="showHome" ng-click="goHome()">

    </button>
  </ion-nav-buttons>
    <ion-content scroll="false">
        <!--<div style="color: gray; position: absolute; z-index: 10; bottom: 0; background-color: white;">DRAFT</div>-->
        <div class="row" style="width: 67%; margin-left: auto; margin-right: auto;">
            <button class="col button button-full button-small button-light button-outline" ng-if="showWings"></button>
            <button class="col button button-full button-small button-light" ng-class="setSubHeaderGrid()">{{schedule.assignedDate | date: 'EEEE, MMMM d, y'}}</button>
            <button class="col button button-full button-small button-light button-outline" ng-if="showWings"></button>
        </div>
        <ion-scroll class="card custom-background" scroll="true" direction="y" id="customBackground6" ng-style="customBackground('customBackground6')">
            <ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh('hello')">
                
            </ion-refresher>
            <div class="text-center assertive padding" ng-if="!secondWindowWidth()">
                (rotate device to see {{firstWindowWidth() ? "end" : "start/end"}} times)
            </div>
            <div class="item">
                {{schedule.note}}
            </div>
            <div class="card">
                <span ng-repeat="section in schedule.schedule track by $index">
                    <div class="item item-divider">
                        {{section[0]}}
                    </div>
                    
                    
                    <div class="item row" ng-repeat="spot in section[1] track by $index" ng-if="canEdit && currentUser === spot[3]" ng-click="selectMember(who(spot[3]))">
                        <div class="col">
                            <b>{{spot[0]}}</b>
                        </div>
                        <div class="col" ng-if="firstWindowWidth()">
                            <b>{{spot[1] | date: "h:mm a"}}<span ng-if="secondWindowWidth()"> - {{spot[2] | date: "h:mm a"}}</span></b>
                        </div>
                        <div class="col" ng-if="users[spot[3]].status !== 'suspended'">
                            <b>{{users[spot[3]].firstName}}
                            {{fourthWindowWidth() || (users[spot[3]].firstName.length + users[spot[3]].lastName.length <= 12) && users[spot[3]].status !== 'suspended' && users[spot[3]].nickName && thirdWindowWidth() ? users[spot[3]].lastName : users[spot[3]].lastName.slice(0, 1) + "."}}
                            <span ng-if="users[spot[3]].nickName && users[spot[3]].status !== 'suspended'"> 
                                ({{users[spot[3]].nickName}})
                            </span>
                            &nbsp&nbsp&nbsp<icon ng-if="spot[4] && canEdit" class="ion-eye icon icon-small"></icon></b>
                        </div>
                        
                        <div class="col" ng-if="users[spot[3]].status === 'suspended'"><strike>
                            {{users[spot[3]].firstName}}
                            {{fourthWindowWidth() || (users[spot[3]].firstName.length + users[spot[3]].lastName.length <= 12) && users[spot[3]].status !== 'suspended' && users[spot[3]].nickName && thirdWindowWidth() ? users[spot[3]].lastName : users[spot[3]].lastName.slice(0, 1) + "."}}
                            <span ng-if="users[spot[3]].nickName && users[spot[3]].status !== 'suspended'"> 
                                ({{users[spot[3]].nickName}})
                            </span></strike>
                            &nbsp&nbsp&nbsp<icon ng-if="spot[4] && canEdit" class="ion-eye icon icon-small"></icon>
                        </div>
                    </div>
                    <div class="item row" ng-repeat="spot in section[1] track by $index" ng-if="!canEdit && currentUser === spot[3]">
                        <div class="col">
                            <b>{{spot[0]}}</b>
                        </div>
                        <div class="col" ng-if="firstWindowWidth()">
                            <b>{{spot[1] | date: "h:mm a"}}<span ng-if="secondWindowWidth()"> - {{spot[2] | date: "h:mm a"}}</span></b>
                        </div>
                        <div class="col">
                            <b>{{users[spot[3]].firstName}}
                            {{fourthWindowWidth() || (users[spot[3]].firstName.length + users[spot[3]].lastName.length <= 12) && users[spot[3]].nickName || !users[spot[3]].nickName && thirdWindowWidth() ? users[spot[3]].lastName : users[spot[3]].lastName.slice(0, 1) + "."}}
                            <span ng-if="users[spot[3]].nickName"> 
                                ({{users[spot[3]].nickName}})
                            </span>
                            </b>
                        </div>
                    </div>
                    
                    
                    
                    <div class="item row" ng-repeat="spot in section[1] track by $index" ng-if="canEdit && currentUser !== spot[3]" ng-click="selectMember(who(spot[3]))">
                        <div class="col">
                            {{spot[0]}}
                        </div>
                        <div class="col" ng-if="firstWindowWidth()">
                            {{spot[1] | date: "h:mm a"}}<span ng-if="secondWindowWidth()"> - {{spot[2] | date: "h:mm a"}}</span>
                        </div>
                        <div class="col" ng-if="users[spot[3]].status !== 'suspended'">
                            {{users[spot[3]].firstName}}
                            {{fourthWindowWidth() || (users[spot[3]].firstName.length + users[spot[3]].lastName.length <= 12) && users[spot[3]].status !== 'suspended' && users[spot[3]].nickName && thirdWindowWidth() ? users[spot[3]].lastName : users[spot[3]].lastName.slice(0, 1) + "."}}
                            <span ng-if="users[spot[3]].nickName && users[spot[3]].status !== 'suspended'"> 
                                ({{users[spot[3]].nickName}})
                            </span>
                            &nbsp&nbsp&nbsp<icon ng-if="spot[4] && canEdit" class="ion-eye icon icon-small"></icon>
                        </div>
                        
                        <div class="col" ng-if="users[spot[3]].status === 'suspended'"><strike>
                            {{users[spot[3]].firstName}}
                            {{fourthWindowWidth() || (users[spot[3]].firstName.length + users[spot[3]].lastName.length <= 12) && users[spot[3]].status !== 'suspended' && users[spot[3]].nickName && thirdWindowWidth() ? users[spot[3]].lastName : users[spot[3]].lastName.slice(0, 1) + "."}}
                            <span ng-if="users[spot[3]].nickName && users[spot[3]].status !== 'suspended'"> 
                                ({{users[spot[3]].nickName}})
                            </span></strike>
                            &nbsp&nbsp&nbsp<icon ng-if="spot[4] && canEdit" class="ion-eye icon icon-small"></icon>
                        </div>
                    </div>
                    <div class="item row" ng-repeat="spot in section[1] track by $index" ng-if="!canEdit && currentUser !== spot[3]">
                        <div class="col">
                            {{spot[0]}}
                        </div>
                        <div class="col" ng-if="firstWindowWidth()">
                            {{spot[1] | date: "h:mm a"}}<span ng-if="secondWindowWidth()"> - {{spot[2] | date: "h:mm a"}}</span>
                        </div>
                        <div class="col">
                            {{users[spot[3]].firstName}}
                            {{fourthWindowWidth() || (users[spot[3]].firstName.length + users[spot[3]].lastName.length <= 12) && users[spot[3]].nickName || !users[spot[3]].nickName && thirdWindowWidth() ? users[spot[3]].lastName : users[spot[3]].lastName.slice(0, 1) + "."}}
                            <span ng-if="users[spot[3]].nickName"> 
                                ({{users[spot[3]].nickName}})
                            </span>
                        </div>
                    </div>
                </span>
            </div>
                
                <div class="card" ng-if="canEdit">
                    <div class="item item-divider">
                        Changes History
                    </div>
                    <div ng-if="schedule.state !== 'saved'" ng-repeat="histItem in historyItems track by $index" class="item item-text-wrap">
                        {{histItem}}
                    </div>
                    <div class="item item-text-wrap" ng-if="schedule.state === 'saved'">
                        Changes will appear here after the schedule has been Published.
                    </div>
                </div>
            <!--</div>-->
        </ion-scroll>
    </ion-content>
</ion-view>